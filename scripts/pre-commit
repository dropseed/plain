#!/bin/sh -e
BOLD=$(tput bold)
NORMAL=$(tput sgr0)

echo "${BOLD}Checking formatting and linting${NORMAL}"
./scripts/fix --check

echo ""
echo "${BOLD}Validating type annotations${NORMAL}"
./scripts/type-validate

echo ""
echo "${BOLD}Running tests${NORMAL}"
./scripts/test

echo ""
echo "${BOLD}Running preflight in example${NORMAL}"
# Ensure the example database exists (tests already started PostgreSQL via Docker)
PGPASSWORD=postgres createdb -h localhost -U postgres plain_example 2>/dev/null || true
cd example && DATABASE_URL="${DATABASE_URL:-postgres://postgres:postgres@localhost/plain_example}" uv run plain preflight
