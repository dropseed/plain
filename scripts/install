#!/bin/sh -e

for package in plain*;
do
    echo ""
    echo "${BOLD}Installing dependencies for $package${NORMAL}"
    cd $package
    uv sync
    cd ..
done

if [ ! -f .git/hooks/pre-commit ]; then
    echo ""
    echo "${BOLD}Installing git pre-commit hook${NORMAL}"
    cp scripts/pre-commit .git/hooks/pre-commit
fi

# Make sure prettier and other network-reliant tools are installed
# (Codex only has network access during setup)

if ! command -v prettier >/dev/null 2>&1; then
    echo ""
    echo "${BOLD}Prefetching prettier${NORMAL}"
    npx --yes prettier --version >/dev/null
fi

echo ""
echo "${BOLD}Installing plain-code tools${NORMAL}"
uv run --package plain-code --isolated plain-code install
